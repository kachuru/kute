#!/bin/bash
if [ ! -n "$2" ]
then
    echo "Usage ./jump <remote_host> <jump_key> [port]"
    exit
fi

if [ $(ssh -p22 -A $1 "whoami") != "root" ]
then
    echo "You must be the root user in order to install JumpCloud on the remote server."
    echo "Try prefixing the remote host address with 'root@'"
    exit
fi

host=$1
key=$2

if [ -n "$3" ]
then
    port=$3
    ssh -p22 -A $host "sed -i 's/^# *Port 22$/Port $port/' /etc/ssh/sshd_config && systemctl restart sshd.service"
fi

ssh -A $host -p$port "curl --silent --show-error --header 'x-connect-key: $key' https://kickstart.jumpcloud.com/Kickstart | bash"
